#include "ets_sys.h"
#include "osapi.h"
#include "gpio.h"
#include "os_type.h"
#include "user_config.h"
#include "user_interface.h"
#include "driver/uart.h"
#include "espconn.h"
#include "at_custom.h"
#include "mem.h"
#include "c_math.h"

struct DStrct1{


	int32  Mode;

	    char Soft_AP_ssid[32] ;
	    char Soft_AP_password[64] ;

	    char Router_ssid[32] ;
	    char Router_password[64] ;

	    int32 UDP_Client_Port;
	    int32 UDP_Server_Port;

	    int32 Sending_Packet_Size;
	    int32 Terminator;
};
extern struct DStrct1 info;

union {
	uint32 data[53];
	struct DStrct1 data_struct;
}conv;





#define SERVER_STRING "Server: UDP_Telemetery/0.1.0\r\n"

void headers(struct espconn * client, const char *filename);


int TCP_sent_flag=1;
int TCP_recieved_flag=0;
//The Form binary HTML Page
char Page[] = {
		0x3C,0x21,0x44,0x4F,0x43,0x54,0x59,0x50,0x45,0x20,0x48,0x54,0x4D,0x4C,0x3E,0x0D,
		0x0A,0x0D,0x0A,0x3C,0x68,0x74,0x6D,0x6C,0x3E,0x0D,0x0A,0x20,0x20,0x3C,0x73,0x74,
		0x79,0x6C,0x65,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x74,0x65,0x78,0x74,0x2F,0x63,
		0x73,0x73,0x22,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x62,0x6F,0x64,0x79,0x7B,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x62,0x61,0x63,0x6B,0x67,
		0x72,0x6F,0x75,0x6E,0x64,0x2D,0x63,0x6F,0x6C,0x6F,0x72,0x3A,0x20,0x23,0x64,0x32,
		0x62,0x34,0x61,0x63,0x3B,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x6D,0x61,0x72,0x67,0x69,0x6E,0x2D,0x6C,0x65,0x66,0x74,0x3A,0x20,0x32,0x30,0x25,
		0x3B,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x6D,0x61,0x72,0x67,
		0x69,0x6E,0x2D,0x72,0x69,0x67,0x68,0x74,0x3A,0x20,0x32,0x30,0x25,0x3B,0x0D,0x0A,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x62,0x6F,0x72,0x64,0x65,0x72,0x3A,
		0x20,0x32,0x70,0x78,0x20,0x64,0x6F,0x74,0x74,0x65,0x64,0x20,0x62,0x6C,0x61,0x63,
		0x6B,0x3B,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x70,0x61,0x64,
		0x64,0x69,0x6E,0x67,0x3A,0x20,0x31,0x30,0x70,0x78,0x20,0x31,0x30,0x70,0x78,0x20,
		0x31,0x30,0x70,0x78,0x3B,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x7D,0x0D,0x0A,0x0D,
		0x0A,0x20,0x20,0x3C,0x2F,0x73,0x74,0x79,0x6C,0x65,0x3E,0x0D,0x0A,0x0D,0x0A,0x3C,
		0x68,0x65,0x61,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x3C,0x74,0x69,0x74,0x6C,0x65,0x3E,
		0x54,0x65,0x6C,0x65,0x6D,0x65,0x74,0x65,0x72,0x79,0x20,0x53,0x65,0x74,0x69,0x6E,
		0x67,0x73,0x3C,0x2F,0x74,0x69,0x74,0x6C,0x65,0x3E,0x0D,0x0A,0x3C,0x2F,0x68,0x65,
		0x61,0x64,0x3E,0x0D,0x0A,0x0D,0x0A,0x3C,0x62,0x6F,0x64,0x79,0x3E,0x0D,0x0A,0x20,
		0x20,0x20,0x3C,0x68,0x32,0x3E,0x55,0x44,0x50,0x20,0x54,0x65,0x6C,0x65,0x6D,0x65,
		0x74,0x65,0x72,0x79,0x20,0x55,0x6E,0x69,0x74,0x20,0x53,0x65,0x74,0x69,0x6E,0x67,
		0x73,0x3A,0x3C,0x2F,0x68,0x32,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x3C,0x66,0x6F,0x72,
		0x6D,0x20,0x61,0x63,0x74,0x69,0x6F,0x6E,0x3D,0x20,0x20,0x22,0x68,0x74,0x74,0x70,
		0x3A,0x2F,0x2F,0x31,0x39,0x32,0x2E,0x31,0x36,0x38,0x2E,0x34,0x2E,0x31,0x2F,0x56,
		0x72,0x74,0x66,0x79,0x22,0x20,0x6D,0x65,0x74,0x68,0x6F,0x64,0x3D,0x22,0x70,0x6F,
		0x73,0x74,0x22,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x3C,0x74,0x61,0x62,0x6C,0x65,
		0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,0x0D,
		0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,
		0x3E,0x52,0x6F,0x75,0x74,0x65,0x72,0x20,0x53,0x53,0x49,0x44,0x3A,0x3C,0x2F,0x74,
		0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x3C,0x74,0x64,0x3E,0x3C,0x69,0x6E,0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,
		0x22,0x74,0x65,0x78,0x74,0x22,0x20,0x6E,0x61,0x6D,0x65,0x3D,0x22,0x52,0x49,0x44,
		0x22,0x2F,0x3E,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x3C,0x2F,0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x3C,0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x52,0x6F,0x75,0x74,0x65,0x72,0x20,0x50,0x61,
		0x73,0x73,0x77,0x6F,0x72,0x64,0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x3C,0x69,
		0x6E,0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x74,0x65,0x78,0x74,0x22,
		0x20,0x6E,0x61,0x6D,0x65,0x3D,0x22,0x52,0x50,0x57,0x44,0x22,0x2F,0x3E,0x3C,0x2F,
		0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x74,
		0x72,0x3E,0x0D,0x0A,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,
		0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x3C,0x74,0x64,0x3E,0x41,0x63,0x63,0x65,0x73,0x73,0x20,0x50,0x6F,0x69,0x6E,0x74,
		0x20,0x53,0x53,0x49,0x44,0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x3C,0x69,0x6E,
		0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x74,0x65,0x78,0x74,0x22,0x20,
		0x6E,0x61,0x6D,0x65,0x3D,0x22,0x41,0x49,0x44,0x22,0x2F,0x3E,0x3C,0x2F,0x74,0x64,
		0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x74,0x72,0x3E,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,0x0D,0x0A,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,
		0x41,0x63,0x63,0x65,0x73,0x73,0x20,0x50,0x6F,0x69,0x6E,0x74,0x20,0x50,0x61,0x73,
		0x73,0x77,0x6F,0x72,0x64,0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x3C,0x69,0x6E,
		0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x74,0x65,0x78,0x74,0x22,0x20,
		0x6E,0x61,0x6D,0x65,0x3D,0x22,0x41,0x50,0x57,0x44,0x22,0x2F,0x3E,0x3C,0x2F,0x74,
		0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x74,0x72,
		0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,0x0D,
		0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,
		0x3E,0x43,0x6F,0x6E,0x6E,0x65,0x63,0x74,0x69,0x6F,0x6E,0x20,0x4D,0x6F,0x64,0x65,
		0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x73,0x65,0x6C,0x65,0x63,0x74,0x20,0x69,0x64,
		0x3D,0x22,0x73,0x74,0x61,0x74,0x69,0x6F,0x6E,0x22,0x20,0x6E,0x61,0x6D,0x65,0x3D,
		0x22,0x53,0x54,0x41,0x54,0x49,0x4F,0x4E,0x22,0x20,0x73,0x69,0x7A,0x65,0x3D,0x22,
		0x31,0x22,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x6F,0x70,0x74,0x69,0x6F,0x6E,0x20,0x76,0x61,
		0x6C,0x75,0x65,0x3D,0x22,0x31,0x22,0x20,0x73,0x65,0x6C,0x65,0x63,0x74,0x65,0x64,
		0x3D,0x22,0x73,0x65,0x6C,0x65,0x63,0x74,0x65,0x64,0x22,0x3E,0x53,0x74,0x61,0x74,
		0x69,0x6F,0x6E,0x3C,0x2F,0x6F,0x70,0x74,0x69,0x6F,0x6E,0x3E,0x0D,0x0A,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,
		0x6F,0x70,0x74,0x69,0x6F,0x6E,0x20,0x76,0x61,0x6C,0x75,0x65,0x3D,0x22,0x30,0x22,
		0x3E,0x41,0x63,0x63,0x65,0x73,0x73,0x20,0x50,0x6F,0x69,0x6E,0x74,0x3C,0x2F,0x6F,
		0x70,0x74,0x69,0x6F,0x6E,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x73,0x65,0x6C,0x65,0x63,0x74,
		0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,
		0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,
		0x74,0x72,0x3E,0x0D,0x0A,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,
		0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x3C,0x74,0x64,0x3E,0x4C,0x6F,0x63,0x61,0x6C,0x20,0x55,0x44,0x50,0x20,0x50,
		0x6F,0x72,0x74,0x20,0x4E,0x75,0x6D,0x62,0x65,0x72,0x3A,0x3C,0x2F,0x74,0x64,0x3E,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,
		0x64,0x3E,0x3C,0x69,0x6E,0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x6E,
		0x75,0x6D,0x62,0x65,0x72,0x22,0x20,0x6E,0x61,0x6D,0x65,0x3D,0x22,0x55,0x44,0x50,
		0x4C,0x50,0x22,0x2F,0x3E,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x3C,0x2F,0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x52,0x65,0x6D,0x6F,0x74,0x65,
		0x20,0x55,0x44,0x50,0x20,0x50,0x6F,0x72,0x74,0x20,0x4E,0x75,0x6D,0x62,0x65,0x72,
		0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x3C,0x69,0x6E,0x70,0x75,0x74,0x20,0x74,
		0x79,0x70,0x65,0x3D,0x22,0x6E,0x75,0x6D,0x62,0x65,0x72,0x22,0x20,0x6E,0x61,0x6D,
		0x65,0x3D,0x22,0x55,0x44,0x50,0x52,0x50,0x22,0x2F,0x3E,0x3C,0x2F,0x74,0x64,0x3E,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x74,0x72,0x3E,
		0x0D,0x0A,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,
		0x64,0x3E,0x53,0x65,0x72,0x69,0x61,0x6C,0x20,0x54,0x65,0x72,0x6D,0x69,0x6E,0x61,
		0x74,0x6F,0x72,0x20,0x54,0x79,0x70,0x65,0x3A,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,
		0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x73,
		0x65,0x6C,0x65,0x63,0x74,0x20,0x69,0x64,0x3D,0x22,0x74,0x65,0x72,0x6D,0x69,0x6E,
		0x61,0x74,0x6F,0x72,0x22,0x20,0x6E,0x61,0x6D,0x65,0x3D,0x22,0x54,0x45,0x52,0x4D,
		0x49,0x4E,0x41,0x54,0x4F,0x52,0x22,0x20,0x73,0x69,0x7A,0x65,0x3D,0x22,0x31,0x22,
		0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x3C,0x6F,0x70,0x74,0x69,0x6F,0x6E,0x20,0x76,0x61,0x6C,0x75,
		0x65,0x3D,0x22,0x31,0x22,0x20,0x73,0x65,0x6C,0x65,0x63,0x74,0x65,0x64,0x3D,0x22,
		0x73,0x65,0x6C,0x65,0x63,0x74,0x65,0x64,0x22,0x3E,0x4E,0x6F,0x6E,0x65,0x3C,0x2F,
		0x6F,0x70,0x74,0x69,0x6F,0x6E,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x6F,0x70,0x74,0x69,0x6F,
		0x6E,0x20,0x76,0x61,0x6C,0x75,0x65,0x3D,0x22,0x30,0x22,0x3E,0x5C,0x72,0x5C,0x72,
		0x3C,0x2F,0x6F,0x70,0x74,0x69,0x6F,0x6E,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x2F,0x73,0x65,0x6C,
		0x65,0x63,0x74,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x3C,0x2F,0x74,0x72,0x3E,0x0D,0x0A,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x3C,0x74,0x72,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x53,0x65,0x72,0x69,0x61,0x6C,0x20,
		0x44,0x61,0x74,0x61,0x20,0x53,0x69,0x7A,0x65,0x3A,0x20,0x28,0x69,0x6E,0x66,0x20,
		0x3D,0x20,0x2D,0x31,0x29,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x3C,0x74,0x64,0x3E,0x3C,0x69,0x6E,0x70,
		0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x6E,0x75,0x6D,0x62,0x65,0x72,0x22,
		0x20,0x6E,0x61,0x6D,0x65,0x3D,0x22,0x50,0x43,0x54,0x53,0x49,0x5A,0x45,0x22,0x2F,
		0x3E,0x3C,0x2F,0x74,0x64,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
		0x3C,0x2F,0x74,0x72,0x3E,0x0D,0x0A,0x0D,0x0A,0x0D,0x0A,0x20,0x20,0x20,0x20,0x3C,
		0x2F,0x74,0x61,0x62,0x6C,0x65,0x3E,0x0D,0x0A,0x20,0x20,0x20,0x20,0x3C,0x69,0x6E,
		0x70,0x75,0x74,0x20,0x74,0x79,0x70,0x65,0x3D,0x22,0x73,0x75,0x62,0x6D,0x69,0x74,
		0x22,0x20,0x76,0x61,0x6C,0x75,0x65,0x20,0x3D,0x20,0x22,0x53,0x61,0x76,0x65,0x22,
		0x20,0x2F,0x3E,0x0D,0x0A,0x20,0x20,0x3C,0x2F,0x66,0x6F,0x72,0x6D,0x3E,0x0D,0x0A,
		0x3C,0x2F,0x62,0x6F,0x64,0x79,0x3E,0x0D,0x0A,0x0D,0x0A,0x3C,0x2F,0x68,0x74,0x6D,
		0x6C,0x3E,
};

void TCP_Send(struct espconn * con,char * payload,int len)
{
	TCP_sent_flag=0;
	espconn_sent(con ,payload ,len);
}

int Ptoi(char * str)
{
	int j,val=0;
	int i=os_strlen(str);
	for(j=0;j<i;j++){
		str[j]=str[j]-48;
	}
	switch (i)
	{
	case 0:
		return -1;
		break;
	case 1:
		return (int) str[0];
	case 2:
		return (int)str[1]+10*(int)str[0];
	case 3:
		return (int)str[2]+10*(int)str[1]+100*(int)str[0];
	case 4:
		return (int)str[3]+10*(int)str[2]+100*(int)str[1]+1000*(int)str[0];
	default:
		return -1;

	}
}

int Search_Word(char *str , int len , char *word){
    int i=0,j=0;
    int Wl=os_strlen(word);
        for(i=0 ;i <= (len -Wl);i++)
	    {
	     for(j=0;j <  Wl;j++){
	      if(str[i+j]!=word[j])
	      	  {
	    	  	  break;
	      	  }else if(j==Wl-1)
	      		  return i;
	     }
	    }


	return -1;
}




void connect_callback (void *arg){


}


void disconnect_callback (void *arg){

}

void TCP_sent_callback (void *arg){

}

void ICACHE_FLASH_ATTR process_form(char *pdata , unsigned short len,void * conn)
{
	int Locations[10];
	    int length[9];
	    int address[0];
	    char Post_Error=0;

	    char Local_Port[5]="";
	    char Remote_Port[5]="";
	    int LP,RP;
	    int Header_type;
	    int Mode;

	    int Buffer_Size;
		TCP_recieved_flag=1;

		if(Search_Word(pdata,10,"POST")!=-1){

				Locations[0]=Search_Word(pdata,len,"RID");

				Locations[1]=Search_Word(pdata,len,"&RPWD");

				Locations[2]=Search_Word(pdata,len,"&AID");

				Locations[3]=Search_Word(pdata,len,"&APWD");

				Locations[4]=Search_Word(pdata,len,"&STATION");

				Locations[5]=Search_Word(pdata,len,"&UDPLP");

				Locations[6]=Search_Word(pdata,len,"&UDPRP");

				Locations[7]=Search_Word(pdata,len,"&TERMINATOR");

				Locations[8]=Search_Word(pdata,len,"&PCTSIZE");

	            length[0]=Locations[1]-Locations[0]-4;
	            length[1]=Locations[2]-Locations[1]-6;
	            length[2]=Locations[3]-Locations[2]-5;
	            length[3]=Locations[4]-Locations[3]-6;
	            length[4]=Locations[5]-Locations[4]-9;
	            length[5]=Locations[6]-Locations[5]-7;
	            length[6]=Locations[7]-Locations[6]-7;
	            length[7]=Locations[8]-Locations[7]-12;

	            address[0]=Locations[0]+4;
	            address[1]=Locations[1]+6;
	            address[2]=Locations[2]+5;
				address[3]=Locations[3]+6;
				address[4]=Locations[4]+9;
				address[5]=Locations[5]+7;
				address[6]=Locations[6]+7;
				address[7]=Locations[7]+12;
				address[8]=Locations[8]+9;

				if(length[0]>0 && address[0]!=-1){
				os_memcpy(&info.Router_ssid,&pdata[address[0]],length[0]);
				}
				if(length[1]>0 && address[1]!=-1){
				os_memcpy(&info.Router_password,&pdata[address[1]],length[1]);
				}
				if(length[2]>0 && address[2]!=-1){
				os_memcpy(&info.Soft_AP_ssid,&pdata[address[2]],length[2]);
				}
				if(length[3]>0 && address[3]!=-1){
				os_memcpy(&info.Soft_AP_password,&pdata[address[3]],length[3]);
				}
				if(length[6]>0 && address[6]!=-1){
				os_memcpy(&Remote_Port,&pdata[address[6]],length[6]);
	            RP=Ptoi(Remote_Port);
            	info.UDP_Client_Port=(uint32)RP;
				}

				if(length[5]>0 && address[5]!=-1){
				os_memcpy(&Local_Port,&pdata[address[5]],length[5]);
	            LP=Ptoi(Local_Port);
                info.UDP_Server_Port=(uint32)LP;
				}

				if(address[4]!=-1)
				info.Mode=(uint32)pdata[address[4]];

				if(address[7]!=-1)
				info.Terminator=(uint32)pdata[address[7]];

                os_memcpy(&conv.data_struct,&info,sizeof(info));
	            spi_flash_erase_sector(0x3D);
	            spi_flash_write(0x3D000,conv.data,sizeof(info));

	            TCP_Send((struct espconn *)conn,"<h1>OK!!! ,Changes Saved<h1>",sizeof("<h1>OK!!! ,Changes Saved<h1>"));

	            return ;

	 }
		headers((struct espconn *) conn ,"http");
	    TCP_Send((struct espconn *)conn,Page,os_strlen(Page));
}

void ICACHE_FLASH_ATTR  TCP_recv_callback (void *arg,char *pdata,unsigned short len){

	process_form(pdata,len,arg);


    os_delay_us(5000);
	espconn_disconnect((struct espconn *)arg);

}

void ICACHE_FLASH_ATTR headers(struct espconn * client, const char *filename)
{
 char *buf =(char *)os_zalloc(sizeof(char)*128);
 (void)filename;  /* could use filename to determine file type */

 os_strcpy(buf, "HTTP/1.0 200 OK\r\n");
 TCP_Send(client, buf, strlen(buf));
 os_strcpy(buf, "Connection: close\r\n");
 TCP_Send(client, buf, strlen(buf));
 os_strcpy(buf, SERVER_STRING);
 TCP_Send(client, buf, strlen(buf));
 os_sprintf(buf, "Content-Type: text/html\r\n");
 TCP_Send(client, buf, strlen(buf));
 os_strcpy(buf, "\r\n");
 TCP_Send(client, buf, strlen(buf));
 os_delay_us(1000);
 os_free(buf);
}
